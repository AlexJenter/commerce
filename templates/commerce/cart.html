{% extends 'commerce/_layouts/main' %}

{% block main %}
    <div class="row">
        <div class="eleven columns">

            <table class="u-full-width">
                <thead>
                <tr>
                    <th>Product</th>
                    <th>Qty</th>
                    <th class="text-right">Price</th>
                </tr>
                </thead>
                <tbody>
                {% for item in cart.lineItems %}
                    <tr>
                        <td>
                            <strong>{{ item.description }}</strong><br>
                            ({{ item.sku }})
                            <br>
                            <code>{{ item.options|json_encode }}</code>
                            <form method="POST">
                                <input type="hidden" name="action" value="commerce/cart/removeLineItem"/>
                                <input type="hidden" name="redirect" value="commerce/cart"/>
                                {{ getCsrfInput() }}
                                <input type="hidden" name="lineItemId" value="{{ item.id }}"/>
                                <input type="submit" class="button link" value="Remove"/>
                            </form>
                        </td>
                        <td>
                            <form method="POST">
                                <input type="hidden" name="action" value="commerce/cart/updateLineItem">
                                <input type="hidden" name="redirect" value="commerce/cart">
                                <input type="hidden" name="lineItemId" value="{{ item.id }}">
                                <input type="text" placeholder="My Note" size="20" name="note" value="{{ item.note }}">
                                <input type="number" name="qty" min="1" value="{{ item.qty }}">
                                {{ getCsrfInput() }}
                                <select name="options[color]">
                                    <option value="blue" {% if item.options.color == 'blue' %}selected{% endif %}>Blue</option>
                                    <option value="white" {% if item.options.color == 'white' %}selected{% endif %}>White</option>
                                    <option value="red" {% if item.options.color == 'red' %}selected{% endif %}>Red</option>
                                </select>
                                <input type="submit" class="button" value="Update"/>
                            </form>
                        </td>
                        <td class="text-right">
                            {% if item.onSale %}
                                <s>Price: {{ item.price|commerceCurrency }}</s><br>
                                Sale Off: {{ item.saleAmount|commerceCurrency }}<br>
                                Sale Price {{ item.salePrice|commerceCurrency }}<br>
                                Sale Price Subtotal: {{ item.subtotalWithSale|commerceCurrency }}<br>
                            {% else %}
                                Price: {{ item.price|commerceCurrency }}<br>
                                Sale Price {{ item.salePrice|commerceCurrency }}<br>
                                Sale Price Subtotal: {{ item.subtotalWithSale|commerceCurrency }}<br>
                            {% endif %}

                            Discount: {{ item.discount|commerceCurrency }}<br>
                            Taxes: {{ item.tax|commerceCurrency }}<br>
                            Taxes (Inc): {{ item.taxIncluded|commerceCurrency }}<br>
                            Shipping: {{ item.shippingCost|commerceCurrency }}<br>
                            Total: {{ item.total|commerceCurrency }}<br>
                        </td>
                    </tr>
                {% endfor %}

                {% for adjustment in cart.adjustments %}
                    <tr>
                        <td>{{ adjustment.type }}
                        </td>
                        <td><strong>{{ adjustment.name }}</strong><br>({{ adjustment.description }})</td>
                        <td class="text-right">{{ adjustment.amount|commerceCurrency }}</td>
                    </tr>
                {% endfor %}

                <tr>
                    <td>
                        {# Remove all line items to empty the cart: #}
                        <form method="POST">
                            <input type="hidden" name="action" value="commerce/cart/removeAllLineItems"/>
                            <input type="hidden" name="redirect" value="commerce/cart"/>
                            {{ getCsrfInput() }}
                            <input class="button link" type="submit" value="Empty the Cart"/>
                        </form>

                        {# Update Coupon form uses the single update controller action: #}
                        <form method="POST">
                            <input type="hidden" name="action" value="commerce/cart/updateCart">
                            <input type="hidden" name="redirect" value="commerce/cart">
                            {{ getCsrfInput() }}
                            <input type="text" name="couponCode" width="11" value="{{ cart.couponCode }}"
                                   placeholder="{{ "Coupon Code"|t }}"><br>
                            <input type="submit" class="button"
                                   value="{% if cart.couponCode %}Change{% else %}Apply{% endif %} Coupon"/>
                        </form>

                    </td>
                    <td>
                    </td>
                    <td class="text-right">
                        Item Total: {{ cart.itemTotal|commerceCurrency }}<br>
                        Base Discount: {{ cart.baseDiscount|commerceCurrency }}<br>
                        Base Shipping Cost: {{ cart.baseShippingCost|commerceCurrency }}<br>
                        <h4>Total Price: {{ cart.totalPrice|commerceCurrency }}</h4>
                    </td>
                </tr>

                </tbody>
            </table>

            <a class="button button-primary" href="{{ url('commerce/checkout') }}">Checkout</a>

            {% if not cart.lineItems|length %}
                <p>You have no items in your cart, add some on the <a href="/commerce/products">products page</a>.</p>
            {% endif %}

        </div>
    </div>
{% endblock %}
