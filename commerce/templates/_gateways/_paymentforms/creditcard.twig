{% import "_includes/forms" as forms %}

{% set currentYear = date()|date_modify("+1 year").format('Y') %}

<div id="payment-method-{{ paymentMethod.id }}-form" class="payment-method-form {% if order and order.paymentMethodId != paymentMethod.id %}hidden{% endif %}">
	<form method="POST">
		<input type="hidden" name="action" value="commerce/payments/pay"/>
		{% if order %}
			<input type="hidden" name="orderNumber" value="{{ order.number }}"/>
		{% endif %}
		<input type="hidden" name="paymentMethodId" value="{{ paymentMethod.id }}"/>
		{{ getCsrfInput() }}

		<fieldset>
			<legend>Card Holder</legend>

			<div class="grid" data-cols="2">

				<!-- Card Holder Name -->
				<div class="item" data-colspan="1">
					{{ forms.text({
						name: 'firstName',
						maxlength: 70,
						placeholder: "First Name"|t,
						autocomplete: false,
						class: 'card-holder-first-name'~(paymentForm.getErrors('firstName') ? ' error'),
						value: paymentForm.firstName,
						required: true,
					}) }}
				</div>

				<div class="item" data-colspan="1">
					{{ forms.text({
						name: 'lastName',
						maxlength: 70,
						placeholder: "Last Name"|t,
						autocomplete: false,
						class: 'card-holder-last-name'~(paymentForm.getErrors('lastName') ? ' error'),
						value: paymentForm.lastName,
						required: true,
					}) }}
				</div>
			</div>

			{% set errors = [] %}
			{% for attributeKey in ['firstName', 'lastName'] %}
			    {% set errors = errors|merge(paymentForm.getErrors(attributeKey)) %}
			{% endfor %}

			{{ forms.errorList(errors) }}
		</fieldset>

		<!-- Card Number -->
		<fieldselt>
			<legend>Card</legend>

			<div class="multitext">
				<div class="multitextrow">

					{{ forms.text({
						name: 'number',
						maxlength: 19,
						placeholder: "Card Number"|t,
						autocomplete: false,
						class: 'card-number'~(paymentForm.getErrors('number') ? ' error'),
						value: paymentForm.number
					}) }}

				</div>

				<div class="multitextrow">
					{{ forms.text({
						id: 'cc-exp',
						type: 'tel',
						placeholder: "MM"|t~' / '~"YY"|t
					}) }}

					{{ forms.text({
						type: 'tel',
						name: 'cvv',
						placeholder: "CVV"|t,
						class: 'card-cvc'~(paymentForm.getErrors('cvv') ? ' error'),
						value: paymentForm.cvv
					}) }}
				</div>
			</div>

			{% set errors = [] %}
			{% for attributeKey in ['number', 'month', 'year', 'cvv'] %}
			    {% set errors = errors|merge(paymentForm.getErrors(attributeKey)) %}
			{% endfor %}

			{{ forms.errorList(errors) }}

		</fieldset>

		{#
		<div class="form-group {% if paymentForm is defined and (paymentForm.hasErrors('month') or paymentForm.hasErrors('year')) %}has-error{% endif %}">
			<label>Card Expiry Date</label>

			<select class="form-control" name="month">
				{% for month in 1..12 %}
					<option value="{{ month }}" {% if paymentForm.month == month %}selected{% endif %}>{{ month }}</option>
				{% endfor %}
			</select>
			<span> / </span>
			<select class="required form-control"
					name="year">
				{% for year in currentYear-1..(currentYear + 12) %}
					<option value="{{ year }}"
							{% if paymentForm.year == year %}selected{% endif %}>{{ year }}</option>
				{% endfor %}
			</select>
		</div>
		#}


		<div class="footer">
			<div class="buttons right">
			<input type="submit" class="btn submit" value="Pay {{ order.totalPrice|currency(order.currency,true) }} Now">
			</div>
		</div>

	</form>
</div>
