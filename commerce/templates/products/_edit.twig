{% extends "commerce/_layouts/cp" %}

{% set selectedSubnavItem = "products" %}

{% set crumbs = [
{ label: "Products"|t, url: url('commerce/products') }
] %}

{% set fullPageForm = true %}
{% set saveShortcutRedirect = continueEditingUrl %}

{% import "_includes/forms" as forms %}
{% import "commerce/products/_fields" as productFields %}


{% block saveButton %}
	<div class="btngroup">
		<input type="submit" class="btn submit" value="{{ 'Save'|t }}">
		<div class="btn submit menubtn"></div>
		<div class="menu">
			<ul>
				<li><a class="formsubmit" data-redirect="{{ continueEditingUrl }}">
					{{ "Save and continue editing"|t }}
					{{ forms.optionShortcutLabel('S') }}
				</a></li>
			</ul>
		</div>
	</div>
{% endblock %}


{% block main %}
		<input type="hidden" name="action" value="commerce/products/saveProduct">
		<input type="hidden" name="redirect" value="commerce/products">
		<input type="hidden" name="typeId" value="{{ productType.id }}">
		{% if craft.isLocalized() %}<input type="hidden" name="locale" value="{{ product.locale }}">{% endif %}
		{{ getCsrfInput() }}
		{% if product.id %}<input type="hidden" name="productId" value="{{ product.id }}">{% endif %}


		<div class="grid first" data-max-cols="3">
			<div class="item" data-position="left" data-min-colspan="2"
				 data-max-colspan="3">

				<div id="fields" class="pane">
					{% include "_includes/tabs" %}

					{{ forms.textField({
						label: "Title"|t,
						locale: product.locale,
						id: 'title',
						name: 'title',
						value: product.title,
						errors: product.getErrors('title'),
						first: true,
						autofocus: true,
						required: true,
						maxlength: 255
					}) }}

					{% set allProductTab = productType.asa('productFieldLayout').getFieldLayout().getTabs() %}
					{% for tab in allProductTab %}
						<div id="tab{{ loop.index }}" {% if not loop.first %} class="hidden" {% endif %}>
							{% include "_includes/fields" with {
							fields: tab.getFields(),
							element: product,
							} only %}
						</div>
					{% endfor %}
				</div>

				{% if productType.hasVariants %}
					<div class="pane">
						{% include "_includes/tabs" with {
							tabs: {
								variantsTab: { label: 'Variants'|t, url: '#variantsTab' }
							}
						} %}

						{{ variantMatrixHtml|raw }}
					</div>
				{% endif %}
			</div>

			<div class="item" data-position="right" data-colspan="1">

				{% if craft.isLocalized() %}
					<ul id="locales" class="pane">
						{% for localeId in localeIds %}
							{% set localeName = craft.i18n.getLocaleById(localeId).name %}
							<li{% if localeId == product.locale %} class="sel"{% endif %}>
								{%- if localeId == product.locale -%}
									{{ localeName }}
									{{ forms.lightswitch({
										name: 'localeEnabled',
										on:   product.localeEnabled,
										small: true
									}) }}
								{%- else -%}
									{% set localeUrl = url(
									'commerce/products/'~productType.handle~'/'~craft.request.getSegment(4)~'/'~localeId
									) -%}
									<a href="{{ localeUrl }}">{{ localeName }}</a>
									<div class="status {{ localeId in enabledLocales ? 'enabled' : 'disabled' }}"></div>
								{%- endif -%}
							</li>
						{% endfor %}
					</ul>
				{% endif %}


				<div class="pane meta">
					{{ forms.textField({
						label: "Slug"|t,
						locale: product.locale,
						id: 'slug',
						name: 'slug',
						value: product.slug,
						placeholder: 'Enter slug'|t,
						errors: product.getErrors('slug')|merge(product.getErrors('uri'))
					}) }}

					{{ forms.dateTimeField({
						label: 'Post Date'|t,
						id: 'availableOn',
						name: 'availableOn',
						value: product.availableOn,
						errors: product.getErrors('availableOn')
					}) }}

					{{ forms.dateTimeField({
						label: 'Expiry Date'|t,
						id: 'expiresOn',
						name: 'expiresOn',
						value: product.expiresOn,
						errors: product.getErrors('expiresOn')
					}) }}

					{% set enabledswitch %}
						<div class="left">
							{{ forms.lightswitch({
								id: 'enabled',
								name: 'enabled',
								label: 'Enabled?',
								on: product.enabled,
								disabled: false
							}) }}
						</div>
						<div class="right">
							{% if productId is defined %}
								<input type="button"
									   class="btn small formsubmit"
									   value="{{ 'Delete'|t }}"
									   data-action="commerce/products/deleteProduct"
									   data-confirm="{{ 'Are you sure you want to delete this product?'|t }}"
									   data-redirect="commerce/products">
							{% endif %}
						</div>
					{% endset %}

					{{ forms.field({
						id:       'status',
						label:    'Enabled'
					},enabledswitch) }}

				</div>{#END PANE#}

				<div class="pane meta">
					{{ forms.selectField({
						label: 'Tax Category'|t,
						name: 'taxCategoryId',
						value: product.taxCategoryId,
						required: true,
						options: taxCategories
					}) }}

					{{ forms.checkboxField({
						fieldLabel: 'Free Shipping'|t,
						name: 'freeShipping',
						checked: (product.id ? product.freeShipping : 0),
					}) }}

					{{ forms.checkboxField({
						fieldLabel: 'Promotable'|t,
						name: 'promotable',
						checked: (product.id ? product.promotable : 1),
					}) }}
				</div>

				{% if not productType.hasVariants %}
					{% namespace 'variants['~(primaryVariant.id ?: 'new1')~']' %}
						<div class="pane meta">
							{{ productFields.generalVariantFields(primaryVariant) }}
						</div>
						<div class="pane meta">
							{{ productFields.dimensionVariantFields(primaryVariant) }}
						</div>
					{% endnamespace %}
				{% endif %}
			</div>
		</div>

	{% if not product.slug %}
		{% includejs %}
			window.slugGenerator = new Craft.SlugGenerator('#title', '#slug');
		{% endincludejs %}
	{% endif %}

{% endblock %}
