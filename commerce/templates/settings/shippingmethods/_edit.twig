{% extends "commerce/_layouts/settingscp" %}

{% set crumbs = [
{ label: "Commerce Settings"|t, url: url('commerce/settings') },
{ label: "Shipping Methods"|t, url: url('commerce/settings/shippingmethods') },
] %}

{% import "_includes/forms" as forms %}

    {% set tabs = {
    0: {'label':'Shipping Method','url':'#shippingMethodTab'}
    }
    %}
    {% if not newMethod %}
        {%  set tabs = tabs|merge({1: {'label':'Rules','url':'#rules'}}) %}
    {% endif %}

{% set content %}
<form method="post" accept-charset="UTF-8" data-saveshortcut>
<div id="shippingMethodTab">

    <input type="hidden" name="action" value="commerce/shippingMethod/save">
    <input type="hidden" name="redirect" value="commerce/settings/shippingmethods/{id}#rules">

    {{ getCsrfInput() }}
    {% if shippingMethod.id %}<input type="hidden" name="shippingMethodId" value="{{ shippingMethod.id }}">{% endif %}

    {{ forms.textField({
        first: true,
        label: "Name"|t,
        instructions: "What this shipping method will be called in the CP."|t,
        id: 'name',
        name: 'name',
        value: shippingMethod.name,
        errors: shippingMethod.getErrors('name'),
        autofocus: true,
        required: true,
        translatable: true
    }) }}

    {{ forms.checkboxField({
        label: "Enable this shipping method on the front end?"|t,
        id: 'enabled',
        name: 'enabled',
        value: 1,
        checked: shippingMethod.enabled,
        errors: shippingMethod.getErrors('enabled')
    }) }}

    {{ forms.checkboxField({
        label: "New carts get this status by default"|t,
        id: 'default',
        name: 'default',
        value: 1,
        checked: shippingMethod.default,
        errors: shippingMethod.getErrors('default')
    }) }}

</div>

<div id="rules" class="hidden">

<h2>{{ "Shipping Rules"|t }}</h2>
{% if shippingRules|length %}
<table id="shippingRules" class="data fullwidth collapsible">
    <thead>
    <tr>
        <th>{{ 'Name'|t }}</th>
        <th>{{ 'Method'|t }}</th>
        <th>{{ 'Country'|t }}</th>
        <th>{{ 'State'|t }}</th>
        <th>{{ 'Filtering Settings'|t }}</th>
        <th>{{ 'Charge Settings'|t }}</th>
        <th>{{ 'Enabled?'|t }}</th>
        <td class="thin"></td>
        <td class="thin"></td>
    </tr>
    </thead>
    <tbody>
    {% for shippingRule in shippingRules %}
        <tr data-id="{{ shippingRule.id }}" data-name="{{ shippingRule.name }}">
            <th scope="row" data-title="Name"><a href="{{ url('commerce/settings/shippingmethods/'~shippingRule.methodId~'/shippingrules/'~shippingRule.id) }}">{{ shippingRule.name }}</a></th>
            <td>{{ shippingRule.method.name }}</td>
            <td>{{ shippingRule.country.name|default('All') }}</td>
            <td>{{ shippingRule.state.name|default('All') }}</td>
            <td>
                Minimum Order Quantity: {{ shippingRule.minQty }}<br/>
                Maximum Order Quantity: {{ shippingRule.maxQty }}<br/>
                Minimum Order Total Price: {{ shippingRule.minTotal }}<br/>
                Maximum Order Total Price: {{ shippingRule.maxTotal }}<br/>
                Minimum Order Weight: {{ shippingRule.minWeight }}<br/>
                Maximum Order Weight: {{ shippingRule.maxWeight }}
            </td>
            <td>
                Base Rate: {{ shippingRule.baseRate }}<br/>
                Per Item Rate: {{ shippingRule.perItemRate }}<br/>
                Weight Rate: {{ shippingRule.weightRate }}<br/>
                Percentage Rate: {{ shippingRule.percentageRate }}<br/>
                Minimum Rate: {{ shippingRule.minRate }}<br/>
                Maximum Rate: {{ shippingRule.maxRate }}
            </td>
            <td>{{ shippingRule.enabled ? 'Yes'|t : 'No'|t }}</td>
            <td class="thin">
                <a class="move icon disabled" title="{{ 'Delete'|t }}" role="button"></a>
            </td>
            <td class="thin">
                <a class="delete icon" title="{{ 'Delete'|t }}" role="button"></a>
            </td>
        </tr>
    {% endfor %}

    </tbody>
</table>
{% else %}
    <p>{{ 'No shipping rules exist yet for this shipping method.' }}</p>
{% endif %}
<div class="btngroup submit first">
    <a href="{{ url('commerce/settings/shippingmethods/'~shippingMethod.id~'/shippingrules/new') }}" class="btn submit">{{ 'New Shipping Rule'|t }}</a>
</div>

</div>

<div class="buttons">
    <input type="submit" class="btn submit" value="{{ newMethod ? 'Save and set rules'|t :'Save'|t }}">
</div>
</form>
{% endset %}

{% set js %}
var adminTable = new Craft.AdminTable({
    tableSelector: '#shippingRules',
    deleteAction: 'commerce/shippingRule/delete',
    sortable: true,
    reorderAction: 'commerce/shippingRule/reorder',
    confirmDeleteMessage: '{{ "Are you sure you want to delete “{name}”?"|t }}'
});
{% endset %}
{% includeJs js %}