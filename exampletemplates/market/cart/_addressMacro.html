{# Address Form Macro #}
{% macro addressForm(modelName, model) %}

    {% set countries = craft.market.countriesList %}
    {% set states = craft.market.statesArray %}
    {% set addressFields = {
        firstName : 1,
        lastName : 1,
        address1: 0,
        address2: 0,
        zipCode: 0,
        phone: 0,
        alternativePhone: 0,
        company: 0,
    } %}

    <table style="border: 1px solid #000; margin-bottom: 20px">
        {% for key,required in addressFields %}
            <tr>
                <td>{{ key|makeLabel }} {{ required ? '*' : '' }}</td>
                <td><input name="{{ modelName }}[{{ key }}]" value="{{ model ? model[key] : '' }}"></td>
                <td>{% if model and model.getErrors(key) %}{{ model.getErrors(key)|join }}{% endif %}</td>
            </tr>
        {% endfor %}

        <tr>
            <td>Country *</td>
            <td>
                {{ craft.market.renderFormMacro('select', {
                    name: modelName ~ '[countryId]',
                    value: model ? model.countryId : '',
                    options: countries,
                    class: 'address-country',
                }) }}
            </td>
            <td>{% if model and model.getErrors('countryId') %}{{ model.getErrors('countryId')|join }}{% endif %}</td>
        </tr>

        <tr>
            <td>State</td>
            <td>
                {{ craft.market.renderFormMacro('select', {
                    name: modelName ~ '[stateId]',
                    value: model ? model.stateId : '',
                    options: model and states[model.countryId] is defined ? states[model.countryId] : [],
                    class: 'address-state',
                }) }}

                <label>
                    Custom:
                    <input name="{{ modelName }}[stateName]" value="{{ model ? model.stateName : '' }}">
                    {% if model and model.getErrors('stateName') %}<br/>{{ model.getErrors('stateName')|join }}{% endif %}
                </label>
            </td>
            <td>{% if model and model.getErrors('stateId') %}{{ model.getErrors('stateId')|join }}{% endif %}</td>
        </tr>
    </table>
{% endmacro %}
{# End Address Form Macro #}