{%- set static = (static is defined ? static : false) %}
{%- set cols = (cols is defined ? cols : []) %}
{%- set rows = (rows is defined ? rows : []) -%}

<table id="{{ id }}" class="shadow-box editable">
    <thead>
    <tr>
        {% for col in cols %}
            <th scope="col" class="header">{{ col.heading ? col.heading : 'Â ' }}</th>
        {% endfor %}
        {% if not static %}
            <th class="header" colspan="2"></th>
        {% endif %}
    </tr>
    </thead>
    <tbody>
    {% for row in rows %}
        <tr data-id="{{ row.id }}">
            <input type="hidden" name="{{ name }}[{{ row.id }}][current]" value="{{ row.id }}"/>
            {% for col in cols %}
                {% set cellName = name~'['~row.id~']['~col.attribute~']' %}
                {% set value = (row[col.attribute] is defined ? row[col.attribute] : null) %}
                {% set textual = (col.type in ['singleline','multiline','number']) %}
                <td class="{% if textual %}textual{% endif %} {% if col.class is defined %}{{ col.class }}{% endif %}"{% if col.width is defined %} width="{{ col.width }}"{% endif %}>
                    {%- if col.type == 'select' -%}
                        {% include "_includes/forms/select" with {
                        class:    'small',
                        name:     cellName,
                        options:  col.options,
                        value:    value,
                        disabled: static
                        } only %}
                    {%- elseif col.type == 'checkbox' -%}
                        <input type="hidden" name="{{ cellName }}">
                        <input type="checkbox" name="{{ cellName }}"
                               value="1"{% if value %} checked{% endif %}{% if static %} disabled{% endif %}>
                    {%- else -%}
                        <textarea name="{{ cellName }}"
                                  rows="1"{% if static %} disabled{% endif %}>{{ value }}</textarea>
                    {%- endif -%}
                </td>
            {% endfor %}
            {% if not static %}
                <td class="thin action"><a class="move icon" title="{{ 'Reorder'|t }}"></a></td>
                <td class="thin action"><a class="delete icon" title="{{ 'Delete'|t }}"></a></td>
            {% endif %}
        </tr>
    {% endfor %}
    </tbody>
</table>
{% if not static %}
    <div class="btn add icon">{{ addRowLabel is defined ? addRowLabel : "Add a row"|t }}</div>
{% endif %}

{% if not static and (initJs is not defined or initJs) %}

    {% includeJsResource "market/MarketRecordTable.js" %}
    {% set js %}
    new Craft.Market.EditableTable(
    "{{ id   | namespaceInputId   | e('js') }}",
    "{{ name | namespaceInputName | e('js') }}",
    {{ cols|json_encode|raw }},
    {

    });
    {% endset %}

    {% includeJs js %}
{% endif %}
